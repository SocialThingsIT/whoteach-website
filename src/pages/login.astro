---
import Layout from '~/layouts/PageLayout.astro';
---

<Layout metadata={{ title: 'Accedi - WhoTeach' }}>
  <section class="py-16 md:py-20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="max-w-md mx-auto">
        <div class="bg-white dark:bg-slate-900 rounded-lg shadow-lg p-8">
          <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Accedi</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2">Accedi al tuo account WhoTeach</p>
          </div>

          <div id="auth-container">
            <div id="login-form">
              <form id="loginForm" class="space-y-6">
                <div>
                  <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Email
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-800 dark:text-white"
                    placeholder="inserisci la tua email"
                  />
                </div>

                <div>
                  <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Password
                  </label>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-800 dark:text-white"
                    placeholder="inserisci la tua password"
                  />
                </div>

                <div id="error-message" class="text-red-600 text-sm hidden"></div>

                <button
                  type="submit"
                  id="login-btn"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-300 ease-in-out"
                >
                  Accedi
                </button>
              </form>

              <div class="mt-6 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                  Non hai un account?
                  <button id="show-signup" class="text-blue-600 hover:text-blue-700 font-medium">
                    Registrati
                  </button>
                </p>
              </div>
            </div>

            <div id="signup-form" class="hidden">
              <form id="signupForm" class="space-y-6">
                <div>
                  <label for="signup-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Email
                  </label>
                  <input
                    type="email"
                    id="signup-email"
                    name="email"
                    required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-800 dark:text-white"
                    placeholder="inserisci la tua email"
                  />
                </div>

                <div>
                  <label for="signup-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Password
                  </label>
                  <input
                    type="password"
                    id="signup-password"
                    name="password"
                    required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-800 dark:text-white"
                    placeholder="crea una password"
                  />
                </div>

                <div>
                  <label for="confirm-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Conferma Password
                  </label>
                  <input
                    type="password"
                    id="confirm-password"
                    name="confirmPassword"
                    required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-800 dark:text-white"
                    placeholder="conferma la password"
                  />
                </div>

                <div id="signup-error-message" class="text-red-600 text-sm hidden"></div>

                <button
                  type="submit"
                  id="signup-btn"
                  class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-300 ease-in-out"
                >
                  Registrati
                </button>
              </form>

              <div class="mt-6 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                  Hai gi√† un account?
                  <button id="show-login" class="text-blue-600 hover:text-blue-700 font-medium">
                    Accedi
                  </button>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  import { signIn, signUp } from '~/utils/auth';

  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');
  const loginFormContainer = document.getElementById('login-form');
  const signupFormContainer = document.getElementById('signup-form');
  const showSignupBtn = document.getElementById('show-signup');
  const showLoginBtn = document.getElementById('show-login');
  const errorMessage = document.getElementById('error-message');
  const signupErrorMessage = document.getElementById('signup-error-message');

  showSignupBtn?.addEventListener('click', () => {
    loginFormContainer?.classList.add('hidden');
    signupFormContainer?.classList.remove('hidden');
  });

  showLoginBtn?.addEventListener('click', () => {
    signupFormContainer?.classList.add('hidden');
    loginFormContainer?.classList.remove('hidden');
  });

  loginForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const email = formData.get('email');
    const password = formData.get('password');

    const loginBtn = document.getElementById('login-btn');
    loginBtn.textContent = 'Accedendo...';
    loginBtn.disabled = true;

    const result = await signIn(email, password);

    if (result.success) {
      window.location.href = '/dashboard';
    } else {
      errorMessage.textContent = result.error;
      errorMessage.classList.remove('hidden');
      loginBtn.textContent = 'Accedi';
      loginBtn.disabled = false;
    }
  });

  signupForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const email = formData.get('email');
    const password = formData.get('password');
    const confirmPassword = formData.get('confirmPassword');

    if (password !== confirmPassword) {
      signupErrorMessage.textContent = 'Le password non corrispondono';
      signupErrorMessage.classList.remove('hidden');
      return;
    }

    const signupBtn = document.getElementById('signup-btn');
    signupBtn.textContent = 'Registrando...';
    signupBtn.disabled = true;

    const result = await signUp(email, password);

    if (result.success) {
      window.location.href = '/dashboard';
    } else {
      signupErrorMessage.textContent = result.error;
      signupErrorMessage.classList.remove('hidden');
      signupBtn.textContent = 'Registrati';
      signupBtn.disabled = false;
    }
  });
</script>