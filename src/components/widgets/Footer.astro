---
import { Icon } from 'astro-icon/components';
import { SITE } from 'astrowind:config';
import { getHomePermalink } from '~/utils/permalinks';
import HubSpotForm from '~/components/widgets/HubSpotForm.astro';

interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

interface Links {
  title?: string;
  links: Array<Link>;
}

export interface Props {
  links: Array<Links>;
  secondaryLinks: Array<Link>;
  socialLinks: Array<Link>;
  footNote?: string;
  theme?: string;
}

const { socialLinks = [], secondaryLinks = [], links = [], footNote = '', theme = 'light' } = Astro.props;
---

<!-- Sezione Newsletter (sopra il footer) -->
<section
  class="border-default/20 intersect-once intersect-quarter border-t bg-section transition dark:border-slate-800 dark:bg-slate-900 motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
>
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:py-16">
    <div class="grid gap-8 lg:grid-cols-2 lg:items-center">
      <!-- Contenuto sinistra -->
      <div>
        <p class="mb-2 text-sm font-semibold uppercase tracking-wider text-secondary">Iscriviti alla newsletter</p>
        <h2 class="mb-4 text-3xl font-bold text-primary dark:text-white lg:text-4xl">
          Porta l'innovazione nei tuoi corsi, un'email alla volta
        </h2>
        <ul class="space-y-2 text-secondary dark:text-slate-400">
          <li class="flex items-start">
            <Icon name="tabler:arrow-badge-right" class="mr-2 mt-1 h-5 w-5 flex-shrink-0 text-primary" />
            <span>Articoli, risorse e strumenti per semplificare il tuo lavoro</span>
          </li>
          <li class="flex items-start">
            <Icon name="tabler:arrow-badge-right" class="mr-2 mt-1 h-5 w-5 flex-shrink-0 text-primary" />
            <span>Scopri le ultime opportunità per sviluppare e finanziare le tue iniziative</span>
          </li>
          <li class="flex items-start">
            <Icon name="tabler:arrow-badge-right" class="mr-2 mt-1 h-5 w-5 flex-shrink-0 text-primary" />
            <span>Solo ciò che ti serve, quando ti serve: niente fronzoli, niente spam</span>
          </li>
        </ul>
      </div>

      <!-- Form HubSpot destra -->
      <div class="rounded-lg p-8">
        <HubSpotForm
          portalId="6721537"
          formId="07c5824a-6999-4bb7-91d5-2e801d188702"
          region="na1"
          containerId="footer-newsletter-form"
        />
      </div>
    </div>
  </div>
</section>

<!-- Footer principale -->
<footer
  class:list={[
    { dark: theme === 'dark' },
    'not-prose border-default/20 relative border-t bg-white dark:border-slate-800 dark:bg-slate-950',
  ]}
>
  <div class="pointer-events-none absolute inset-0" aria-hidden="true"></div>
  <div class="relative mx-auto max-w-7xl px-4 py-8 dark:text-slate-300 sm:px-6 md:py-12">
    <!-- Layout: Logo sinistra, colonne link destra -->
    <div class="mb-8 grid grid-cols-1 gap-8 lg:grid-cols-12">
      <!-- Logo e secondary links (sinistra) -->
      <div class="lg:col-span-3">
        <div class="mb-4">
          <a class="inline-block text-2xl font-bold text-default dark:text-white" href={getHomePermalink()}>
            {SITE?.name}
          </a>
        </div>
        {
          secondaryLinks?.length > 0 && (
            <div class="flex flex-col gap-2 text-sm">
              {secondaryLinks.map(({ text, href }) => (
                <a
                  class="text-default transition duration-150 ease-in-out hover:text-primary hover:underline dark:text-gray-400 dark:hover:text-primary"
                  href={href}
                  set:html={text}
                />
              ))}
            </div>
          )
        }
      </div>

      <!-- Colonne link (destra) -->
      <div class="grid grid-cols-2 gap-8 sm:grid-cols-3 lg:col-span-9">
        {
          links.map(({ title, links }) => (
            <div>
              <div class="mb-3 text-base font-semibold text-default dark:text-white">{title}</div>
              {links && Array.isArray(links) && links.length > 0 && (
                <ul class="space-y-2 text-sm">
                  {links.map(({ text, href, ariaLabel }) => (
                    <li>
                      <a
                        class="text-default transition duration-150 ease-in-out hover:text-primary hover:underline dark:text-gray-400 dark:hover:text-primary"
                        href={href}
                        aria-label={ariaLabel}
                      >
                        <Fragment set:html={text} />
                      </a>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))
        }
      </div>
    </div>

    <!-- Divider -->
    <div class="border-default/20 border-t dark:border-slate-800"></div>

    <!-- Riga inferiore: copyright sinistra, social destra -->
    <div class="flex flex-col items-center justify-between gap-4 py-6 md:flex-row">
      <!-- Copyright -->
      <div class="text-center text-sm text-muted md:text-left">
        <Fragment set:html={footNote} />
      </div>

      <!-- Social links -->
      {
        socialLinks?.length > 0 && (
          <ul class="flex items-center gap-1">
            {socialLinks.map(({ ariaLabel, href, icon }) => (
              <li>
                <a
                  class="inline-flex items-center rounded-lg p-2.5 text-default transition hover:bg-section hover:text-primary dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-white"
                  aria-label={ariaLabel}
                  href={href}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  {icon && <Icon name={icon} class="h-5 w-5" />}
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </div>
  </div>
</footer>
